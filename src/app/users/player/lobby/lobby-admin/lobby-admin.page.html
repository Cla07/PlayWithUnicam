<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>Lobby di gioco</ion-title>

    <ion-button slot="end" (click)="abbandonaLobby()" color="unicamblue" class="ion-hide-md-down">
      <ion-label text-wrap>Abbandona lobby</ion-label>
      <ion-icon slot="start" name="exit-outline"></ion-icon>
    </ion-button>

    <ion-button slot="end" (click)="abbandonaLobby()" fill="clear" color="unicamblue" shape="round"
      class="ion-hide-md-up">
      <ion-icon slot="icon-only" name="exit-outline"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content>
  <img src="../../../../assets/images/wave-header.png" alt="" class="wave-header">

  <ion-grid fixed style="margin: auto;">
    <ion-row>
      <ion-col size="12">
        <ion-card-header>
          <ion-card-subtitle style="text-align: center; color:#fff;">Codice Lobby</ion-card-subtitle>
          <ion-card-title style="font-size: 25px; font-weight:bold; text-align: center; color:#fff;">
            {{lobby.codice}}
          </ion-card-title>
        </ion-card-header>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size-lg="3.5" size-md="12" size-sm="12" size="12"></ion-col>
      <ion-col size-lg="5" size-md="12" size-sm="12" size="12"></ion-col>
      <ion-col size-lg="3.5" size-md="12" size-sm="12" size="12">
        <ion-button color="unicamred" expand="block" (click)="iniziaPartita()" class="start-button">
          <ion-icon slot="start" name="play"></ion-icon>
          Inizia partita!
        </ion-button>
      </ion-col>
    </ion-row>

    <ion-row>
      <!-- COLONNA INFO LOBBY -->
      <ion-col size-lg="3.5" size-md="12" size-sm="12" size="12">
        <ion-card id="normal-info-card">
          <ion-list>
            <ion-list-header>
              <ion-title class="card-title">Info lobby</ion-title>
            </ion-list-header>

            <ion-item>
              <ion-col size="7">
                <ion-label text-wrap style="font-weight: bold; color:var(--ion-color-unicamblue);">Partecipanti
                </ion-label>
              </ion-col>
              <ion-col size="2.5">
                <ion-label text-wrap style="text-align: center;">
                  <p>MIN</p>
                  <h2>{{lobby.min_giocatori}}</h2>
                </ion-label>
              </ion-col>

              <ion-col size="2.5">
                <ion-label text-wrap style="text-align: center;">
                  <p>MAX</p>
                  <h2>{{lobby.max_giocatori}}</h2>
                </ion-label>
              </ion-col>
            </ion-item>

            <ion-item lines="none" style="padding-bottom: 0px !important;">
              <ion-col>
                <ion-label text-wrap style="font-weight: bold; color:var(--ion-color-unicamblue);">Visibilità pubblica
                </ion-label>
              </ion-col>
              <ion-toggle slot="end" [(ngModel)]="lobby.pubblica" color="unicamblue"></ion-toggle>
            </ion-item>

            <ion-card-content style="padding: 20px; padding-top: 0px !important;">
              <p style="padding-top: 0px !important;">
                Se attivo, permette a tutti i giocatori online di trovare la lobby e di parteciparvi.
              </p>
              <br>
              <ion-button color="unicamblue" expand="block" (click)="generaLink()">Condividi link
              </ion-button>
              <p *ngIf="impossibileCopiareLink">{{link}}</p>
              <br>
              <ion-button color="unicamblue" (click)="modificaLobby()" expand="block">Salva modifiche
              </ion-button>
            </ion-card-content>
          </ion-list>
        </ion-card>

        <ion-card id="expandable-info-card" class="info-card">
          <ion-list>
            <ion-item lines="none" button="true" (click)="espandiInfoLobby()">
              <ion-title class="card-title">Info lobby</ion-title>
              <ion-icon slot="end" name="chevron-forward-circle-outline" *ngIf="!mostraInfoLobby"></ion-icon>
              <ion-icon slot="end" name="chevron-down-circle-outline" *ngIf="mostraInfoLobby"></ion-icon>
            </ion-item>

            <ion-item *ngIf="mostraInfoLobby">
              <ion-col size="7">
                <ion-label text-wrap style="font-weight: bold; color:var(--ion-color-unicamblue);">Partecipanti
                </ion-label>
              </ion-col>
              <ion-col size="2.5">
                <ion-label text-wrap style="text-align: center;">
                  <p>MIN</p>
                  <h2>{{lobby.min_giocatori}}</h2>
                </ion-label>
              </ion-col>

              <ion-col size="2.5">
                <ion-label text-wrap style="text-align: center;">
                  <p>MAX</p>
                  <h2>{{lobby.max_giocatori}}</h2>
                </ion-label>
              </ion-col>
            </ion-item>

            <ion-item lines="none" *ngIf="mostraInfoLobby" style="padding-bottom: 0px !important;">
              <ion-col>
                <ion-label text-wrap style="font-weight: bold; color:var(--ion-color-unicamblue);">Visibilità pubblica
                </ion-label>
              </ion-col>
              <ion-toggle slot="end" [(ngModel)]="lobby.pubblica" color="unicamblue"></ion-toggle>
            </ion-item>

            <ion-card-content style="padding: 20px; padding-top: 0px !important;" *ngIf="mostraInfoLobby">
              <p style="padding-top: 0px !important;">
                Se attivo, permette a tutti i giocatori online di trovare la lobby e di parteciparvi.
              </p>
              <br>
              <ion-button color="unicamblue" expand="block" (click)="generaLink()">Condividi link
              </ion-button>
              <p *ngIf="impossibileCopiareLink">{{link}}</p>
              <br>
              <ion-button color="unicamblue" (click)="modificaLobby()" expand="block">Salva modifiche
              </ion-button>
            </ion-card-content>
          </ion-list>
        </ion-card>
      </ion-col>

      <!-- COLONNA INFO GIOCO -->
      <ion-col size-lg="5" size-md="12" size-sm="12" size="12">
        <ion-card id="normal-game-card">
          <ion-list>
            <ion-list-header>
              <ion-title class="card-title">Info gioco</ion-title>
            </ion-list-header>

            <ion-card-header style="padding-top: 8px;">
              <ion-card-subtitle style="text-align: center;">Nome</ion-card-subtitle>
              <ion-card-title>{{ lobby.nome }}</ion-card-title>
            </ion-card-header>

            <ion-card-content>
              <ion-card-subtitle *ngIf="lobby.regolamento">{{ lobby.regolamento }}
              </ion-card-subtitle>
            </ion-card-content>
          </ion-list>
        </ion-card>

        <ion-card id="expandable-game-card" class="game-card">
          <ion-list>
            <ion-item lines="none" button="true" (click)="espandiInfoGioco()">
              <ion-title class="card-title">Info gioco</ion-title>
              <ion-icon slot="end" name="chevron-forward-circle-outline" *ngIf="!mostraInfoGioco"></ion-icon>
              <ion-icon slot="end" name="chevron-down-circle-outline" *ngIf="mostraInfoGioco"></ion-icon>
            </ion-item>

            <ion-card-header *ngIf="mostraInfoGioco" style="padding-top: 8px;">
              <ion-card-subtitle style="text-align: center;">Nome</ion-card-subtitle>
              <ion-card-title>{{ lobby.nome }}</ion-card-title>
            </ion-card-header>

            <ion-card-content *ngIf="mostraInfoGioco">
              <ion-card-subtitle *ngIf="lobby.regolamento">{{ lobby.regolamento }}
              </ion-card-subtitle>
            </ion-card-content>
          </ion-list>
        </ion-card>
      </ion-col>

      <!-- COLONNA PARTECIPANTI -->
      <ion-col size-lg="3.5" size-md="12" size-sm="12" size="12">
        <ion-card id="normal-players-card">
          <ion-list>
            <ion-list-header>
              <ion-title class="card-title">Partecipanti</ion-title>
            </ion-list-header>

            <ion-item lines="full" *ngFor="let giocatore of giocatori, let i = index;"
              [ngClass]="{'admin-item' : giocatore.username == lobby.admin_lobby}">
              <ion-avatar slot="start">
                <img src="../../../../../assets/icon/lobby-player.png" alt="Giocatore {{ giocatore.username }}">
              </ion-avatar>

              <ion-label text-wrap>{{ giocatore.username }}</ion-label>
              <p slot="end" *ngIf="giocatore.username == lobby.admin_lobby" class="admin-label">ADMIN</p>
              <ion-icon slot="end" name="diamond-outline" *ngIf="giocatore.username == lobby.admin_lobby"
                color="unicamblue"></ion-icon>

              <div tappable (click)="eliminaPartecipante(giocatore.username, i)" title="Elimina partecipante"
                *ngIf="giocatore.username != lobby.admin_lobby">
                <ion-icon slot="end" name="trash-outline" style="font-size: 24px;"></ion-icon>
              </div>
            </ion-item>
          </ion-list>
        </ion-card>

        <ion-card id="slide-players-card">
          <ion-list>
            <ion-list-header>
              <ion-title class="card-title">Partecipanti</ion-title>
            </ion-list-header>

            <ion-slides [options]="{ slidesPerView: 'auto', zoom: false, grabCursor: true }" style="padding:15px;">
              <ion-slide *ngFor="let giocatore of giocatori, let i = index;"
                style="width: 100px; height: 150px; border-radius: 10px;"
                [ngClass]="{'admin-item' : giocatore.username == lobby.admin_lobby}">
                <ion-col style="align-items: center;">
                  <ion-label text-wrap>{{ giocatore.username }}</ion-label>
                  <ion-avatar style="margin: auto;">
                    <img src="../../../../../assets/icon/lobby-player.png" alt="Giocatore {{ giocatore.username }}">
                  </ion-avatar>
                  <br>
                  <p *ngIf="giocatore.username == lobby.admin_lobby" class="admin-label"
                    style="position:absolute; margin-top: -18px; margin-left: 23px; z-index: 1;">ADMIN</p>
                  <ion-icon size="large" name="diamond-outline" *ngIf="giocatore.username == lobby.admin_lobby"
                    color="unicamblue">
                  </ion-icon>

                  <div tappable (click)="eliminaPartecipante(giocatore.username, i)" title="Elimina partecipante"
                    *ngIf="giocatore.username != lobby.admin_lobby">
                    <ion-icon size="large" name="trash-outline"></ion-icon>
                  </div>

                </ion-col>
              </ion-slide>
            </ion-slides>
          </ion-list>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>

<ion-footer class="start-button-footer">
  <ion-toolbar color="unicamred">
    <ion-button fill="clear" color="light" expand="full" (click)="iniziaPartita()">
      <ion-icon slot="start" name="play"></ion-icon>
      Inizia partita!
    </ion-button>
  </ion-toolbar>
</ion-footer>